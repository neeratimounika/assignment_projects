(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{QdDx:function(e,n,t){"use strict";t.r(n),n.default='\x3c!-- <ion-header>\n    <ion-toolbar>\n        <ion-title>records</ion-title>\n    </ion-toolbar>\n</ion-header> --\x3e\n\n\n<ion-content class="ion-padding">\n    <div class="pageMargin"></div>\n    <ion-grid [fixed]="true">\n        <ion-row>\n            <ion-col size-md="8" size="12">\n                <ion-toolbar>\n                    <ion-title *ngIf="myHip" style="text-align:left" color="tertiary">\n                        <strong> {{myHip[\'name\']}} Records </strong>\n                    </ion-title>\n                    <ion-buttons slot="start">\n                        <ion-button (click)="dismiss()" color="dark" fill="clear" shape="round" size="small">\n                            <ion-icon ios="arrow-back" md="arrow-back"></ion-icon>\n                        </ion-button>\n                    </ion-buttons>\n\n                </ion-toolbar>\n            </ion-col>\n        </ion-row>\n\n        <div *ngIf="hipStatus == \'SUCCEEDED\' && doc.length">\n            <div *ngFor="let records of doc">\n                <ion-row>\n                    <span>\n                        <ion-label><small>({{records.docDate | date :\'medium\'}})</small></ion-label>\n                    </span>\n\n                </ion-row>\n                <ion-row>\n\n                    <ion-col size="12" class="ion-no-padding">\n\n                        <div class="msplrCard cursor" style="margin-bottom: 12px; margin-top: 0px;" mode="ios">\n\n                            <ion-card mode="ios" class="ion-no-margin  ">\n                                <div>\n                                    <ion-item lines="none" (click)="expandItem(records, \'doc\')">\n                                        <ion-avatar slot="start">\n                                            <img src="assets/img/image 137.png" />\n                                        </ion-avatar>\n                                        <ion-label class="ion-margin-start ion-padding-start">\n                                            <h3 class="ion-text-wrap ion-no-margin">\n                                                {{records.display}}\n                                            </h3>\n\n                                            <p class="ion-text-wrap">\n                                                <ion-label><small>{{records.patientId}}</small></ion-label>\n                                            </p>\n\n                                        </ion-label>\n\n\n                                    </ion-item>\n                                </div>\n                                <app-expandable expandHeight="auto" [expanded]="records.expanded" class="msplrCard ">\n                                    <div style="margin-top: 1px; " class=" cursor ion-no-margin" mode="ios">\n\n                                        <ion-item lines="full" *ngIf="records.practitioner" style="padding-left: 91px;">\n                                            <ion-label>\n                                                <h3>\n                                                    {{records.practitionerTitle}}\n                                                </h3>\n                                                <p color="medium">\n                                                    <strong>Name</strong> : {{records.practitioner}}\n                                                </p>\n                                            </ion-label>\n                                        </ion-item>\n                                        <ion-item lines="full" *ngIf="records.patientName" style="padding-left: 91px;">\n                                            <ion-label>\n                                                <h3>\n                                                    {{records.patientTitle}}\n                                                </h3>\n                                                <p color="medium">\n                                                    <strong>Name</strong> : {{records.patientName}} <br><strong>Gender</strong> : {{records.patientGender}}\n                                                </p>\n                                            </ion-label>\n                                        </ion-item>\n                                        <ion-item lines="full" *ngIf="records.condition.text" style="padding-left: 91px;">\n                                            <ion-label>\n                                                <h3>\n                                                    {{records.condition.text}}\n                                                </h3>\n                                                <p color="medium" *ngFor="let condition  of records.condition;  let i=index">\n                                                    <strong>{{i+1}}</strong> - {{condition.text}}\n                                                </p>\n                                            </ion-label>\n                                        </ion-item>\n                                        <ion-item lines="full" *ngIf="records.observation.text" style="padding-left: 91px;">\n                                            <ion-label>\n                                                <h3>\n                                                    {{records.observation.text}}\n                                                </h3>\n                                                <p color="medium" *ngFor="let observation  of records.observation;  let i=index">\n                                                    <strong *ngIf="observation.valueQuantity">{{i+1}} -{{observation.text}} {{(observation.valueQuantity)?\'is\':\' \'}} {{observation.valueQuantity}} on  {{observation.effectiveDateTime | date :\'medium\'}} <br></strong>\n                                                </p>\n                                            </ion-label>\n                                        </ion-item>\n                                        <ion-item lines="full" *ngIf="records.conclusion != null" style="padding-left: 91px;">\n                                            <ion-label>\n                                                <h3>\n                                                    Summary\n                                                </h3>\n                                                <p color="medium">\n                                                    <strong>{{records.date}} -</strong> {{records.conclusion}}\n                                                </p>\n                                            </ion-label>\n                                        </ion-item>\n                                        <ion-item lines="full" style="padding-left: 91px;" *ngFor="let file of records.file">\n                                            <ion-label>\n                                                <h3>\n                                                    {{file.title}}\n                                                </h3>\n                                                <h3>\n                                                    Attachments: {{fileName(file.attachmentsurl)}}\n                                                </h3>\n                                                \x3c!-- <small color="medium">\n                                                    [File_size]\n                                                </small> --\x3e\n                                            </ion-label>\n\n\n                                            <ion-buttons slot="end">\n                                                <ion-button color="primary" size="small" (click)="showDocument(file.attachmentsurl,records.consentRequestId,file.title)" style="margin-right: 25px;">\n                                                    View\n                                                </ion-button>\n                                                <ion-button color="medium" size="small" style="font-size: 15px;" (click)="downloadDocument(file.attachmentsurl,records.consentRequestId,file.title)">\n                                                    <ion-icon name="download-outline"></ion-icon>\n                                                </ion-button>\n                                            </ion-buttons>\n                                        </ion-item>\n                                    </div>\n                                </app-expandable>\n                            </ion-card>\n                        </div>\n                    </ion-col>\n                </ion-row>\n            </div>\n\n\n        </div>\n        <div *ngIf="hipStatus == \'SUCCEEDED\' && doc.length == 0">\n            <ion-row class="ion-margin-top">\n                <ion-col size-md="8" offset="2">\n                    <ion-row class="ion-margin-top">\n                        <ion-col class="ion-text-center">\n                            <img src="assets/img/empty_drive.svg" width="30%">\n                        </ion-col>\n                    </ion-row>\n                </ion-col>\n            </ion-row>\n            <ion-row class="ion-margin-top">\n                <ion-col class="ion-text-center">\n                    <ion-text color="dark" class=" ion-text-center ion-text-wrap">\n                        <h3>\n                            There are no files\n                        </h3>\n\n                    </ion-text>\n                </ion-col>\n            </ion-row>\n        </div>\n\n\n        \x3c!-- <ion-row *ngIf="hipStatus != \'SUCCEEDED\'"> --\x3e\n        <ion-row *ngIf="hipStatus != \'SUCCEEDED\' && !isSkeleton" class="ion-margin-top">\n            <ion-col size-md="8" offset="2">\n                <ion-row class="ion-margin-top">\n                    <ion-col class="ion-text-center">\n                        <img src="assets/img/noRecords.png" width="30%">\n                    </ion-col>\n                </ion-row>\n            </ion-col>\n        </ion-row>\n        <ion-row class="ion-margin-top" *ngIf="hipStatus != \'SUCCEEDED\'  && !isSkeleton ">\n            <ion-col class="ion-text-center">\n                <ion-text color="dark" class=" ion-text-center ion-text-wrap">\n                    <h3>\n                        ABHA service is busy processing, please retry after some time.\n                    </h3>\n\n                </ion-text>\n                <ion-button (click)="abhaLoaderStart()">Retry</ion-button>\n            </ion-col>\n        </ion-row>\n\n    </ion-grid>\n    <ion-grid [fixed]="true" *ngIf="isSkeleton">\n        <ion-row>\n            <ion-col>\n                <ion-card mode="ios" class="ion-margin " *ngFor="let list of [].constructor(3)">\n                    <ion-item lines="none">\n                        <ion-avatar slot="start">\n                            <ion-skeleton-text animated></ion-skeleton-text>\n                        </ion-avatar>\n                        <ion-label>\n                            <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>\n                        </ion-label>\n                        <ion-label>\n                            <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>\n                        </ion-label>\n                        <ion-label>\n                            <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>\n                        </ion-label>\n                        <ion-icon name="ellipse" color="light"></ion-icon>\n                        <ion-icon name="ellipse" color="light"></ion-icon>\n                    </ion-item>\n                </ion-card>\n            </ion-col>\n        </ion-row>\n    </ion-grid>\n</ion-content>'},"T8/b":function(e,n,t){"use strict";t.r(n),t.d(n,"RecordsPageModule",(function(){return x}));var o=t("mrSG"),i=t("fXoL"),s=t("ofXK"),a=t("3Pt+"),r=t("TEn/"),l=t("tyNb"),c=t("AytR"),d=t("sRcL"),p=t("jhN1"),h=t("sdq4"),u=t("mP49");let m=class{constructor(e,n,t,o,i){this.router=e,this.navCtlr=n,this.ajax=t,this.sanitizer=o,this.modalController=i,this.retryMsg=!0,this.docs=!1,this.doc=[],this.multipal=0,this.isSkeleton=!0,this.doc}ngOnInit(){const e=this.router.getCurrentNavigation().extras.state;e.token?(this.phrtoken=e.token,this.myHip=e.hip,this.hipStatus=e.resp,this.abhaLoaderStart()):this.navCtlr.navigateBack("services/abha")}abhaLoaderStart(){this.abhaLoader(),this.crstatus()}crstatus(){this.retryMsg=!1;let e=[this.hipStatus.requestId],n={"content-type":"application/json","X-AUTH-TOKEN":this.phrtoken},t=c.a.phrPostLoginCalls,o={reqType:"crstatus",requestIds:e};this.ajax.postMethod(t,o,n).subscribe(e=>{if(e.status)if(0!=e.response.statuses.length||null!=e.response.statuses){this.hipStatus=e.response.statuses[0];let n=[];for(let t of e.response.statuses)n.push(t.requestId);"SUCCEEDED"==e.response.statuses[0].status?(this.hipStatus=e.response.statuses[0].status,this.finalprofile(n)):this.multipal<4?(this.multipal=this.multipal+1,this.reGenerateRequest()):(this.modalController.dismiss(),this.isSkeleton=!1,"ERRORED"==this.hipStatus.status?(this.ajax.showToast("Please retry",5e3,"warning"),this.dismiss()):this.ajax.showToast("Your request is still in "+this.hipStatus.status,5e3,"warning"))}else this.modalController.dismiss(),this.retryMsg=!0,this.isSkeleton=!1,this.ajax.showToast("Not getting any Records from ABHA , Please retry after some time",5e3,"warning");else this.modalController.dismiss(),this.ajax.showToast(e.response.message,5e3,"warning")})}finalprofile(e){let n={"content-type":"application/json","X-AUTH-TOKEN":this.phrtoken},t=c.a.phrPostLoginCalls,o={reqType:"fetch",requestIds:e};this.ajax.postMethod(t,o,n).subscribe(e=>{this.isSkeleton=!1,this.retryMsg=!0,e.status?(this.modalController.dismiss(),this.hipRecords=e.response.entries,this.dataFromet()):(this.modalController.dismiss(),this.ajax.showToast(e.response.message,5e3,"warning"))})}reGenerateRequest(){this.multipal<4?setTimeout(e=>{this.crstatus()},5e3):(this.isSkeleton=!1,this.modalController.dismiss())}abhaLoader(){return Object(o.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:u.a,cssClass:"abhaloaderView",swipeToClose:!0,componentProps:{},backdropDismiss:!1});e.present(),e.onDidDismiss().then(e=>{})}))}dataFromet(){this.hipRecords.forEach(e=>{let n={condition:[],observation:[],file:[]};n.consentRequestId=e.consentRequestId,e.data.timestamp&&(n.docDate=e.data.timestamp),e.data.entry.forEach(e=>{if("Composition"==e.resource.resourceType&&(e.resource.section&&e.resource.section.forEach(e=>{"Condition"==e.entry[0].reference.split("/")[0]&&(n.condition.text=e.title),"Observation"==e.entry[0].reference.split("/")[0]&&(n.observation.text=e.title)}),e.resource.type.text?n.display=e.resource.type.text:e.resource.type.coding.forEach(e=>{n.display=e.display})),"Condition"==e.resource.resourceType){let t={};t.text=e.resource.code.text,t.fullUrl=e.fullUrl.split("/")[1],n.condition.push(t)}if("Observation"==e.resource.resourceType){let t={};t.text=e.resource.code.text,t.fullUrl=e.fullUrl,e.resource.valueQuantity&&(t.valueQuantity=e.resource.valueQuantity.value+" "+e.resource.valueQuantity.unit),t.effectiveDateTime=e.resource.effectiveDateTime,n.observation.push(t)}if("Patient"==e.resource.resourceType&&(n.patientId=e.resource.id,n.patientGender=e.resource.gender,n.patientTitle=e.resource.resourceType,e.resource.name&&e.resource.name.forEach(e=>{e.text?n.patientName=e.text:n.patientName=e.given})),"Practitioner"==e.resource.resourceType&&e.resource.name&&e.resource.name.forEach(t=>{n.practitioner=t.text,n.practitionerTitle=e.resource.resourceType}),"DiagnosticReport"==e.resource.resourceType){let t={};n.conclusion=e.resource.conclusion,n.date=e.resource.issued.split("T")[0],e.resource.presentedForm&&e.resource.presentedForm.forEach(e=>{t.title=e.title,t.attachmentsurl=e.url,t.contentType=e.contentType,n.file.push(t)})}"DocumentReference"==e.resource.resourceType&&e.resource.content&&e.resource.content.forEach(e=>{let t={};t.title=e.attachment.title,t.attachmentsurl=e.attachment.url,t.contentType=e.attachment.contentType,n.file.push(t)})}),n.expanded=!1,this.doc.push(n)})}showDocument(e,n,t){this.ajax.showLoader();let o={"content-type":"application/json","X-AUTH-TOKEN":this.phrtoken},i=c.a.phrFetchAttachment,s={file:"/"+n+e};this.ajax.postMethod(i,s,o).subscribe(e=>{e.status?this.viewDocuments(e.response.attachment,e.response["content-type"],t):(this.ajax.hideLoader(),this.ajax.showToast(e.response.message,5e3,"warning"))})}viewDocuments(e,n,t){let o={Ext:n.split("/")[1],Name:t},i=e;this.viewDetail(o,i)}viewDetail(e,n){return Object(o.b)(this,void 0,void 0,(function*(){this.ajax.hideLoader();let t=e.Ext.toLowerCase(),o=["jpg","jpeg"].includes(t)?this.sanitizer.bypassSecurityTrustUrl("data:image/jpg;base64,"+n):["png"].includes(t)?this.sanitizer.bypassSecurityTrustUrl("data:image/png;base64,"+n):["pdf"].includes(t)?this.sanitizer.bypassSecurityTrustResourceUrl("data:application/pdf;base64,"+n):"";return(yield this.modalController.create({component:h.a,swipeToClose:!0,componentProps:{data:o,file:e},backdropDismiss:!1})).present()}))}downloadDocument(e,n,t){this.ajax.showLoader();let o={"content-type":"application/json","X-AUTH-TOKEN":this.phrtoken},i=c.a.phrFetchAttachment,s={file:"/"+n+e};this.ajax.postMethod(i,s,o).subscribe(n=>{if(n.status){let t=n.response["content-type"].split("/")[1],o=e.split("/")[2];"pdf"==t?this.downloadPdf(n.response.attachment,t,o):this.downloadfile(n.response.attachment,t,o)}else this.ajax.hideLoader(),this.ajax.showToast(n.response.message,5e3,"warning")})}downloadPdf(e,n,t){this.ajax.hideLoader();let o=`data:application/${n};base64,${e}`;var i=document.createElement("a");i.href=o,i.download=t,i.click()}downloadfile(e,n,t){this.ajax.hideLoader();let o=`data:${n};base64,${e}`;var i=document.createElement("a");i.href=o,i.download=t,i.click()}dismiss(){this.navCtlr.pop()}expandItem(e,n){e.expanded?e.expanded=!1:this[n].map(n=>(n.expanded=e==n&&!n.expanded,n))}fileName(e){return e.split("/")[2]}};m.ctorParameters=()=>[{type:l.g},{type:r.i},{type:d.a},{type:p.b},{type:r.h}],m=Object(o.c)([Object(i.n)({selector:"app-records",template:Object(o.e)(t("QdDx")).default,styles:[Object(o.e)(t("kF5Y")).default]})],m);const g=[{path:"",component:m}];let b=class{};b=Object(o.c)([Object(i.M)({imports:[l.i.forChild(g)],exports:[l.i]})],b);var f=t("aDnW");let x=class{};x=Object(o.c)([Object(i.M)({imports:[s.b,a.b,r.d,b,f.a],declarations:[m]})],x)},kF5Y:function(e,n,t){"use strict";t.r(n),n.default=".ion-text-wrap {\n  display: -webkit-box;\n  -webkit-line-clamp: 1;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.textWrap {\n  display: -webkit-box;\n  -webkit-line-clamp: 1;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\nion-avatar {\n  width: 40px;\n  height: 40px;\n  --border-radius: 0px;\n}\n\n@media only screen and (min-width: 768px) {\n  ion-searchbar {\n    padding-left: 0px !important;\n  }\n}\n\nh3,\nh1 {\n  margin: 0 0 5px !important;\n}\n\nion-card {\n  box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 8px !important;\n}\n\n.card-content-ios {\n  padding-top: 0px;\n  padding-bottom: 0px;\n  padding-left: 0px;\n  padding-right: 0px;\n}"}}]);